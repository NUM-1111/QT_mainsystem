# 用户权限管理界面说明

## 功能概述

用户权限管理界面是一个完整的用户权限管理系统，允许管理员查看、编辑和管理用户的权限设置。

## 界面布局

### 左侧：用户列表
- **用户表格**：显示所有用户的ID、用户名、权限组和最终权限状态
- **刷新列表**：重新加载用户数据
- **添加用户**：创建新用户（需要实现注册对话框）
- **删除用户**：删除选中的用户

### 右侧：权限设置
- **用户名**：显示当前选中用户的名称（只读）
- **权限组**：下拉选择用户的权限组
  - 无权限组：无法访问任何分系统
  - 权限组1：可访问分系统1-3
  - 权限组2：可访问分系统4-5
  - 管理员：可访问所有分系统
- **个人权限限制**：勾选框控制每个分系统的访问权限
  - 勾选表示禁止访问该分系统
  - 最终权限 = 组权限 - 个人限制
- **最终权限预览**：实时显示用户的实际访问权限
- **保存权限设置**：将修改保存到数据库
- **重置**：恢复原始设置

## 权限计算逻辑

### 权限组权限
- **管理员（组0）**：拥有所有分系统的访问权限
- **权限组1（组1）**：可访问分系统1、2、3
- **权限组2（组2）**：可访问分系统4、5
- **无权限组（组-1）**：无法访问任何分系统

### 个人权限限制
用户可以在组权限基础上设置个人限制：
- 勾选某个分系统表示禁止访问该分系统
- 个人限制会覆盖组权限

### 最终权限计算
```
最终权限 = 组权限 AND (NOT 个人限制)
```

## 使用示例

### 示例1：权限组1用户
- 组权限：可访问分系统1、2、3
- 个人限制：禁止访问分系统2
- 最终权限：可访问分系统1、3

### 示例2：权限组2用户
- 组权限：可访问分系统4、5
- 个人限制：禁止访问分系统4
- 最终权限：可访问分系统5

### 示例3：管理员用户
- 组权限：可访问所有分系统
- 个人限制：禁止访问分系统1
- 最终权限：可访问分系统2、3、4、5

## 测试方法

### 方法1：使用主程序
1. 运行主程序 `mainsystem.exe`
2. 点击"用户管理"按钮
3. 在用户管理界面中测试各项功能

### 方法2：使用测试程序
1. 运行测试脚本 `test_user_management.bat`
2. 测试程序会自动创建测试用户数据
3. 直接打开用户管理界面进行测试

## 测试数据

测试程序会创建以下用户：
- **admin**：管理员用户
- **user1**：权限组1用户，禁止访问分系统2
- **user2**：权限组2用户，禁止访问分系统4
- **user3**：无权限组用户

## 注意事项

1. **权限生效**：权限修改后需要用户重新登录才能生效
2. **数据持久化**：所有权限设置都会保存到数据库
3. **权限验证**：主程序会根据用户权限控制按钮的启用/禁用状态
4. **错误处理**：界面包含完整的错误处理和用户提示

## 技术实现

### 核心类
- `UserManagerDialog`：用户管理界面主类
- `UserManager`：用户数据管理
- `GroupManager`：权限组管理
- `PermissionManager`：权限计算引擎
- `DatabaseManager`：数据库操作

### 数据结构
- `User`：用户信息结构
- `Group`：权限组结构
- `RightToSystem`：权限位结构

### 数据库表
- `users`：用户信息表
- `groups`：权限组表
- `user_rights`：用户权限表 